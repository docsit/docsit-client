{"version":3,"sources":["../src/encryption.js"],"names":["window","crypto","webCrypto","utf8StringToArray","str","TypeError","textEncoder","TextEncoder","encode","arrayToUtf8String","array","Array","isArray","ArrayBuffer","isView","TextDecoder","decode","hexStringToBuffer","hex","length","RangeError","Uint8Array","i","parseInt","substring","bufferToHexString","reduce","accumulated","next","toString","padStart","generateKey","magic","password","hexMagic","saltedPassword","keyBuffer","subtle","digest","name","cryptoKey","importKey","encryptMultiple","unencryptedArray","getRandomValues","encryptedArray","Promise","all","map","unencryptedText","encryptedBuffer","encrypt","iv","decryptMultiple","decryptedArray","encryptedText","decryptedBuffer","decrypt","err","error","Error","code","orginalError"],"mappings":"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","sourcesContent":["import webCrypto from '@trust/webcrypto';\n\nconst window = {\n  crypto: webCrypto,\n};\n\nexport const utf8StringToArray = str => {\n  if (typeof str !== 'string') throw new TypeError('Expected input to be a string');\n  const textEncoder = new TextEncoder('utf-8');\n  return textEncoder.encode(str);\n};\n\nexport const arrayToUtf8String = array => {\n  if (!Array.isArray(array) && !ArrayBuffer.isView(array))\n    throw new TypeError('Expected input to be array');\n  const textEncoder = new TextDecoder('utf-8');\n  return textEncoder.decode(array);\n};\n\nexport const hexStringToBuffer = hex => {\n  if (typeof hex !== 'string') throw new TypeError('Expected input to be a string');\n  if (hex.length % 2 !== 0)\n    throw new RangeError('Expected string to be an even number of characters');\n\n  const array = new Uint8Array(hex.length / 2);\n  for (let i = 0; i < hex.length; i += 2) {\n    array[i / 2] = parseInt(hex.substring(i, i + 2), 16);\n  }\n  return array;\n};\n\nexport const bufferToHexString = array => {\n  if (!Array.isArray(array) && !ArrayBuffer.isView(array))\n    throw new TypeError('Expected input to be array');\n  return array.reduce((accumulated, next) => accumulated + next.toString(16).padStart(2, '0'), '');\n};\n\nexport const generateKey = async (magic, password) => {\n  const hexMagic = bufferToHexString(magic);\n  const saltedPassword = `${hexMagic};${password}`;\n  const keyBuffer = await window.crypto.subtle.digest(\n    { name: 'SHA-256' },\n    utf8StringToArray(saltedPassword)\n  ); // TODO: Remove the object for correct web implementation\n  const cryptoKey = await window.crypto.subtle.importKey(\n    'raw',\n    keyBuffer,\n    { name: 'AES-CBC' },\n    true,\n    ['encrypt', 'decrypt']\n  );\n  return cryptoKey;\n};\n\nexport const encryptMultiple = async (unencryptedArray, password) => {\n  const magic = window.crypto.getRandomValues(new Uint8Array(16));\n  const cryptoKey = await generateKey(magic, password);\n  const encryptedArray = await Promise.all(\n    unencryptedArray.map(async unencryptedText => {\n      const encryptedBuffer = await window.crypto.subtle.encrypt(\n        { name: 'AES-CBC', iv: magic },\n        cryptoKey,\n        utf8StringToArray(unencryptedText)\n      );\n      return bufferToHexString(new Uint8Array(encryptedBuffer));\n    })\n  );\n  return {\n    hexMagic: bufferToHexString(magic),\n    encryptedArray,\n  };\n};\n\nexport const decryptMultiple = async (encryptedArray, hexMagic, password) => {\n  const magic = hexStringToBuffer(hexMagic);\n  const cryptoKey = await generateKey(magic, password);\n  const decryptedArray = await Promise.all(\n    encryptedArray.map(async encryptedText => {\n      try {\n        const decryptedBuffer = await window.crypto.subtle.decrypt(\n          { name: 'AES-CBC', iv: magic },\n          cryptoKey,\n          hexStringToBuffer(encryptedText)\n        );\n        return arrayToUtf8String(new Uint8Array(decryptedBuffer));\n      } catch (err) {\n        const error = new Error('Wrong password.');\n        error.code = 'WRONG_PASSWORD';\n        error.orginalError = err;\n        throw error;\n      }\n    })\n  );\n  return decryptedArray;\n};\n"],"file":"encryption.js"}